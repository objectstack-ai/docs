---
title: 架构宪法
description: ObjectStack 的核心设计原则
---

# 架构宪法（The Manifesto）

ObjectStack 的设计遵循三大核心原则，这些原则构成了整个架构的基础。

## 原则一：协议中立（Protocol Neutrality）

### 定义

协议层必须保持技术中立，不依赖于任何特定的实现技术。

### 核心理念

**"协议即标准，实现可替换"**

ObjectStack 的协议层（ObjectQL、ObjectUI）是纯粹的规范定义，不包含任何具体实现。这意味着：

- ObjectQL 协议可以有多种实现（JavaScript、Python、Java 等）
- ObjectUI 协议可以有多种渲染器（React、Vue、Angular 等）
- 底层数据库可以随意切换（MySQL、PostgreSQL、Oracle 等）

### 实践指南

**协议设计时**：
- 使用标准的 JSON Schema 格式
- 避免引入特定语言或框架的概念
- 保持协议的简洁性和可扩展性

**实现开发时**：
- 严格遵循协议规范
- 通过测试套件验证协议兼容性
- 实现之间可以相互替换而不影响应用

### 示例

```json
{
  "type": "query",
  "object": "users",
  "filters": {
    "age": { "$gt": 18 }
  },
  "sort": { "created_at": "desc" },
  "limit": 10
}
```

这个 ObjectQL 查询协议可以被：
- JavaScript 实现转译成 MySQL 查询
- Python 实现转译成 PostgreSQL 查询
- Java 实现转译成 Oracle 查询

## 原则二：机制与实现分离（Mechanism-Implementation Separation）

### 定义

将"做什么"（机制）与"怎么做"（实现）彻底分离。

### 核心理念

**"定义行为，不定义实现"**

开发者只需要：
- 定义数据模型（Schema）
- 定义界面结构（UI Protocol）
- 定义业务规则（Validation Rules）

而不需要关心：
- 数据如何存储
- 界面如何渲染
- 查询如何优化

### 实践指南

**Schema 定义**：

```json
{
  "object": "orders",
  "fields": {
    "order_id": { "type": "text", "primary": true },
    "customer": { "type": "reference", "ref": "customers" },
    "total": { "type": "number" },
    "status": { "type": "select", "options": ["pending", "completed"] }
  }
}
```

开发者只需要定义数据模型，系统自动：
- 创建数据库表结构
- 生成 CRUD API
- 提供数据验证
- 建立关系映射

**UI 定义**：

```json
{
  "type": "page",
  "components": [
    {
      "type": "form",
      "fields": [
        { "name": "customer", "label": "客户", "type": "select" },
        { "name": "total", "label": "总额", "type": "number" }
      ]
    }
  ]
}
```

开发者只需要定义界面结构，系统自动：
- 渲染表单组件
- 处理数据绑定
- 执行表单验证
- 管理状态更新

### 好处

1. **降低学习曲线**：开发者不需要学习底层实现细节
2. **提高开发效率**：专注于业务逻辑而非技术实现
3. **增强可维护性**：业务逻辑独立于技术栈
4. **便于技术升级**：更换底层实现不影响业务代码

## 原则三：数据主权宣言（Data Sovereignty Declaration）

### 定义

用户拥有对其数据的完全控制权和所有权。

### 核心理念

**"数据属于用户，而非平台"**

ObjectStack 坚持本地优先（Local-First）理念：
- 数据默认存储在用户本地
- 用户可以选择自己的数据库
- 没有强制性的云服务绑定
- 支持数据完全离线工作

### 实践指南

**本地优先架构**：

1. **单机模式**：
   - 使用 .oos 文件存储数据（基于 SQLite）
   - 数据完全在本地，无需网络
   - 适合个人应用场景

2. **自托管模式**：
   - 部署到企业自己的服务器
   - 使用企业现有数据库（MySQL、Oracle 等）
   - 企业完全掌控数据

3. **混合模式**：
   - 本地优先，可选云同步
   - 支持端到端加密
   - 用户随时可以导出数据

### 数据迁移自由

**零摩擦迁移**：

```bash
# 从 SQLite 迁移到 MySQL
objectstack migrate --from sqlite://app.oos --to mysql://localhost/mydb

# 从 MySQL 迁移到 PostgreSQL
objectstack migrate --from mysql://... --to postgresql://...
```

由于协议层的抽象，数据可以在不同数据库之间自由迁移，没有厂商锁定。

### 隐私保护

- **字段级加密**：敏感字段可以加密存储
- **字段级权限**：细粒度的数据访问控制
- **审计日志**：完整的数据访问记录
- **数据擦除**：支持完全删除用户数据

### 开源承诺

- 核心协议层（ObjectQL、ObjectUI）采用 MIT/Apache 2.0 开源许可
- 确保协议规范永久开放
- 社区可以自由实现兼容的引擎
- 避免单一厂商控制

## 宪法的意义

这三大原则不是技术细节，而是 ObjectStack 的**核心价值观**：

1. **协议中立**：保证技术选型自由
2. **机制实现分离**：保证开发效率和可维护性
3. **数据主权**：保证用户权益

违背这些原则的功能，即使有短期利益，也不应该加入到 ObjectStack 中。

## 设计决策示例

### ✅ 符合宪法的设计

**场景**：添加全文搜索功能

**决策**：
- 在协议层定义统一的全文搜索语法
- 允许不同实现使用不同的搜索引擎（Elasticsearch、Meilisearch 等）
- 用户可以选择适合自己的搜索方案

### ❌ 违反宪法的设计

**场景**：添加云存储功能

**决策**：
- 强制使用某个特定的云服务商
- 数据必须上传到平台的服务器
- 不提供本地存储选项

**为什么违反**：
- 违反了协议中立原则（绑定特定服务商）
- 违反了数据主权原则（强制云存储）

## 实践检查清单

在设计新功能时，问自己：

- [ ] 这个功能是定义在协议层还是实现层？
- [ ] 是否依赖于特定的技术或服务？
- [ ] 用户是否保持对数据的完全控制？
- [ ] 是否可以有多种实现方式？
- [ ] 是否增加了厂商锁定风险？

## 总结

ObjectStack 的架构宪法不仅是技术指南，更是价值观宣言。它确保：

- **技术自由**：开发者可以选择最适合的技术栈
- **数据自由**：用户完全拥有和控制自己的数据
- **进化自由**：系统可以持续演进而不破坏兼容性

这些原则是 ObjectStack 区别于其他平台的根本所在。
