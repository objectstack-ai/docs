---
title: Schema 定义
description: ObjectQL 中定义对象和字段类型的完整参考
---

# Schema 定义

本文档提供 ObjectQL 的 Schema 定义语言的完整规范。

## 对象定义

对象表示数据库表:

```typescript
{
  objects: {
    [objectName: string]: {
      label?: string              // 显示名称
      icon?: string               // UI 图标
      enable_files?: boolean      // 启用文件附件
      enable_search?: boolean     // 启用全文搜索
      enable_tasks?: boolean      // 启用任务跟踪
      enable_notes?: boolean      // 启用笔记
      enable_api?: boolean        // 通过 API 公开(默认: true)
      enable_share?: boolean      // 启用记录共享
      fields: { /* 字段定义 */ }
      list_views?: { /* 视图定义 */ }
      triggers?: { /* 触发器定义 */ }
      actions?: { /* 操作定义 */ }
      permissions?: { /* 权限定义 */ }
    }
  }
}
```

## 字段类型参考

### 文本字段

```typescript
{
  // 短文本 (VARCHAR)
  field_name: {
    type: 'text',
    label?: string,
    defaultValue?: string,
    required?: boolean,
    unique?: boolean,
    index?: boolean,
    minLength?: number,
    maxLength?: number,
    pattern?: string        // 正则表达式
  },
  
  // 长文本 (TEXT)
  description: {
    type: 'textarea',
    rows?: number           // UI 行数提示
  },
  
  // 富文本 HTML
  content: {
    type: 'html'
  },
  
  // 带验证的邮箱
  email: {
    type: 'email',
    unique?: boolean
  },
  
  // 带验证的 URL
  website: {
    type: 'url'
  }
}
```

### 数值字段

```typescript
{
  // 整数
  quantity: {
    type: 'number',
    scale: 0,               // 无小数位
    min?: number,
    max?: number,
    defaultValue?: number
  },
  
  // 小数
  price: {
    type: 'currency',
    scale: 2,               // 2 位小数
    precision?: number      // 总位数(默认: 15)
  },
  
  // 百分比
  discount: {
    type: 'percent',
    scale: 2
  },
  
  // 自动编号(序列)
  invoice_number: {
    type: 'autonumber',
    formula: 'INV-{0000}'   // 格式模式
  }
}
```

### 日期和时间字段

```typescript
{
  // 仅日期 (YYYY-MM-DD)
  birth_date: {
    type: 'date',
    min?: string,           // '1900-01-01'
    max?: string            // '2100-12-31'
  },
  
  // 日期和时间
  created_at: {
    type: 'datetime',
    defaultValue?: string | (() => Date)
  },
  
  // 仅时间
  start_time: {
    type: 'time'
  }
}
```

### 布尔和选择字段

```typescript
{
  // 布尔复选框
  is_active: {
    type: 'boolean',
    defaultValue?: boolean
  },
  
  // 单选(下拉菜单)
  status: {
    type: 'select',
    options: [
      { label: '草稿', value: 'draft' },
      { label: '已发布', value: 'published' }
    ],
    // 或简单数组
    // options: ['draft', 'published', 'archived']
    defaultValue?: string
  },
  
  // 多选
  tags: {
    type: 'multiSelect',
    options: ['urgent', 'important', 'low-priority']
  }
}
```

### 关系字段

```typescript
{
  // 主从关系(必需的外键)
  // 删除父记录时删除子记录
  account: {
    type: 'master_detail',
    reference_to: 'account',
    required: true,
    on_delete?: 'cascade' | 'restrict'  // 默认: cascade
  },
  
  // 查找(可选的外键)
  // 删除父记录时保留关系
  manager: {
    type: 'lookup',
    reference_to: 'user',
    reference_to_field?: '_id'  // 默认: _id
  },
  
  // 公式字段(计算)
  full_name: {
    type: 'formula',
    formula: '{first_name} {last_name}',
    data_type: 'text'
  },
  
  // 汇总(从相关记录汇总)
  total_opportunities: {
    type: 'summary',
    summary_object: 'opportunity',
    summary_type: 'count',
    summary_field: '_id',
    summary_filters: [['stage', '=', 'closed_won']]
  }
}
```

### 特殊字段

```typescript
{
  // 文件附件
  avatar: {
    type: 'image',
    accept?: string         // 'image/*'
  },
  
  // 多个文件
  attachments: {
    type: 'filesize',
    multiple?: boolean      // 允许多个文件
  },
  
  // JSON 数据
  metadata: {
    type: 'json',
    schema?: object         // 用于验证的 JSON Schema
  },
  
  // 地理位置
  location: {
    type: 'location'        // 存储 { lat, lng, address }
  },
  
  // Markdown 内容
  notes: {
    type: 'markdown'
  }
}
```

## 字段约束

```typescript
{
  field_name: {
    type: 'text',
    
    // 验证
    required: boolean,      // NOT NULL
    unique: boolean,        // UNIQUE 约束
    index: boolean,         // 创建索引
    
    // 文本约束
    minLength: number,
    maxLength: number,
    pattern: string,        // 正则表达式
    
    // 数值约束
    min: number,
    max: number,
    scale: number,          // 小数位数
    precision: number,      // 总位数
    
    // 默认值
    defaultValue: any | (() => any),
    
    // 可见性
    hidden: boolean,        // 从 UI 隐藏
    readonly: boolean,      // 只读
    
    // 依赖关系
    depends_on: string[],   // 字段依赖
    visible_on: string      // 条件可见性
  }
}
```

## 下一步

- 学习[查询 DSL](/docs/objectql/protocol-spec/query-dsl)查询数据
- 探索[聚合操作](/docs/objectql/protocol-spec/aggregation)进行数据分析
- 掌握[变更操作](/docs/objectql/protocol-spec/mutation)修改数据
