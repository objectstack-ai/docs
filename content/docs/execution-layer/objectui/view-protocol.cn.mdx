---
title: 复杂视图协议
description: "高密度集合视图的规范：数据网格、看板、甘特图和日历。"
---

# 复杂视图协议

虽然基础组件处理单个字段，但**视图**处理**记录集合**。

ObjectUI 定义了一套标准的"超级组件"，能够可视化数据列表。这些不仅仅是静态表格；它们是完全交互式的引擎，支持**服务器端分页**、**排序**、**筛选**和**内联编辑**。

## 1. 数据网格 (`view.grid`)

数据网格是企业软件的主要工具。它将 ObjectQL 查询结果映射到表格布局。



### Schema 定义

```json
{
  "type": "view.grid",
  "props": {
    "object": "project", // ObjectQL 数据源
    "filter": [["status", "=", "active"]], // 默认范围
    "columns": [
      { 
        "field": "name", 
        "label": "Project Name", 
        "width": 200, 
        "sortable": true 
      },
      { 
        "field": "budget", 
        "type": "currency",
        "aggregates": "sum" // 在页脚显示总计
      },
      { 
        "field": "owner.name", // 关系点表示法
        "label": "Owner" 
      },
      {
        "field": "progress",
        "type": "progress_bar" // 自定义单元格渲染器
      }
    ],
    "selection": "multiple", // checkbox | single | none
    "actions": [
      { "label": "Delete", "action": "delete_selected" },
      { "label": "Export CSV", "action": "export_grid" }
    ]
  }
}

```

### 关键功能

* **虚拟化：** 可以平稳处理 10,000+ 行，通过仅呈现可见视口。
* **服务器端状态：** 排序（点击标题）和分页（第 2 页）自动通过引擎触发新的 ObjectQL 查询。
* **内联编辑：** 如果在列上设置 `editable: true`，双击时网格会将单元格切换为输入组件。

## 2. 看板 (`view.kanban`)

可视化工作流程。它将标准列表转换为基于 `select` 或 `lookup` 字段的列。

### Schema 定义

```json
{
  "type": "view.kanban",
  "props": {
    "object": "task",
    "group_by": "status", // 列驱动（待做、进行中、完成）
    "columns": ["todo", "doing", "done"], // 明确顺序
    "card_template": {
      "title": "{subject}",
      "subtitle": "{due_date}",
      "tags": ["priority"], // 呈现彩色徽章
      "avatar": "owner.avatar_url",
      "cover": "attachment_image"
    }
  }
}

```

### 交互协议

* **拖放：** 将卡片从"待做"移到"完成"会自动调度 ObjectQL 变更：`UPDATE task SET status = 'done' WHERE id = ...`。
* **泳道：** 支持特定筛选以水平切割面板（例如，按"分配人"的泳道）。

## 3. 甘特图 (`view.gantt`)

最复杂的手动构建视图。ObjectUI 抽象了时间线逻辑、依赖关系和关键路径计算。

### Schema 定义

```json
{
  "type": "view.gantt",
  "props": {
    "object": "project_task",
    "mappings": {
      "id": "_id",
      "start_date": "start_at",
      "end_date": "end_at",
      "progress": "percent_complete",
      "dependencies": "predecessors", // 链接任务（完成到开始）
      "parent": "parent_task" // 树形层次结构
    },
    "scales": ["day", "week", "month"],
    "work_days": ["Mon", "Tue", "Wed", "Thu", "Fri"]
  }
}

```

### 自动规划

如果配置，在甘特图中拖动条形会更新数据库中的 `start_at` 和 `end_at` 字段。如果启用依赖关系，ObjectOS 可以触发"重新规划"计算，以向下移动相关任务。

## 4. 日历 (`view.calendar`)

用于资源规划、事件管理和个人议程。

### Schema 定义

```json
{
  "type": "view.calendar",
  "props": {
    "object": "event",
    "mappings": {
      "title": "subject",
      "start": "start_time",
      "end": "end_time",
      "all_day": "is_all_day",
      "color": "category_color" // 动态着色
    },
    "default_view": "month",
    "allow_resize": true // 拖动事件底部以更改持续时间
  }
}

```

## 5. 视图容器（包装器）

视图很少独立存在。它们通常包装在**视图容器**中，提供标准的"ERP 工具栏"。

```json
{
  "type": "layout.view_container",
  "props": {
    "title": "All Projects",
    "searchable": true, // 添加全局搜索栏
    "filterable": true, // 添加筛选生成器按钮
    "creatable": true   // 添加"新建项目"按钮
  },
  "children": [
    // 用户可以使用标签在这些视图之间切换
    { "type": "view.grid", "label": "List" },
    { "type": "view.kanban", "label": "Board" },
    { "type": "view.gantt", "label": "Timeline" }
  ]
}

```

## 总结

ObjectUI 视图协议将复杂的数据可视化转换为简单的配置。

| 视图类型 | 主要用例 | 关键配置 |
| --- | --- | --- |
| **Grid** | 高密度数据管理、批量操作。 | `columns`、`sort` |
| **Kanban** | 流程跟踪、状态移动。 | `group_by`、`card_template` |
| **Gantt** | 项目规划、依赖关系可视化。 | `start_date`、`end_date`、`dependencies` |
| **Calendar** | 时间管理、预订。 | `start`、`end`、`view_mode` |

:::tip 性能
ObjectUI 中的所有视图都是**延迟加载**。即使你有 100 万个任务，网格也只会获取前 50 个。甘特图只会获取可见时间范围内的任务。这确保 UI 无论数据库大小如何都保持响应迅速。
:::
