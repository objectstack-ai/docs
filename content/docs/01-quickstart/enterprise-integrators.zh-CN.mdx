---
title: ä¼ä¸šé›†æˆäººå‘˜
description: è¿æ¥ ObjectStack åˆ°ä¼ä¸šæ•°æ®åº“å¹¶ä½¿ç”¨ Docker éƒ¨ç½²çš„æŒ‡å—
---

# ä¼ä¸šé›†æˆäººå‘˜æŒ‡å—

æœ¬æŒ‡å—å±•ç¤ºå¦‚ä½•å°† ObjectStack ä¸ç°æœ‰ä¼ä¸šæ•°æ®åº“é›†æˆ,ä»¥åŠå¦‚ä½•ä½¿ç”¨ Docker å®¹å™¨éƒ¨ç½²ã€‚

## ä¸ºä»€ä¹ˆä¼ä¸šé€‰æ‹© ObjectStack?

ä¼ä¸šä¼˜åŠ¿åŒ…æ‹¬:

- ğŸ”Œ **è·¨æ•°æ®åº“** - è¿æ¥åˆ° MySQLã€PostgreSQLã€Oracleã€SQL Server
- ğŸ¢ **å¤šç§Ÿæˆ·** - åœ¨ä¸€ä¸ªéƒ¨ç½²ä¸­æ”¯æŒå¤šä¸ªç»„ç»‡
- ğŸ” **ä¼ä¸šå®‰å…¨** - RBACã€å­—æ®µçº§æƒé™ã€å®¡è®¡æ—¥å¿—
- ğŸ“¦ **å®¹å™¨åŒ–** - Docker å°±ç»ª,é€‚é…ç°ä»£ DevOps å·¥ä½œæµ
- ğŸ”„ **é—ç•™ç³»ç»Ÿé›†æˆ** - è¿æ¥ç°æœ‰æ•°æ®åº“,æ— éœ€è¿ç§»

## éƒ¨ç½²é€‰é¡¹

### é€‰é¡¹ 1: è¿æ¥åˆ°ç°æœ‰æ•°æ®åº“

å°† ObjectStack ä¸å½“å‰çš„ MySQL æˆ– PostgreSQL æ•°æ®åº“é…åˆä½¿ç”¨ã€‚

**é€‚ç”¨äº**: ä¸ç°æœ‰ç³»ç»Ÿé›†æˆã€æ¸è¿›å¼è¿ç§»

### é€‰é¡¹ 2: Docker å®¹å™¨éƒ¨ç½²

åœ¨ Docker å®¹å™¨ä¸­éƒ¨ç½² ObjectOS,ä½¿ç”¨æ‰˜ç®¡æ•°æ®åº“ã€‚

**é€‚ç”¨äº**: æ–°éƒ¨ç½²ã€å¾®æœåŠ¡æ¶æ„ã€äº‘åŸç”Ÿç¯å¢ƒ

## é€‰é¡¹ 1: è¿æ¥åˆ°ç°æœ‰æ•°æ®åº“

### å‰ç½®è¦æ±‚

- Node.js 18+ å·²å®‰è£…
- å¯è®¿é—® MySQL 5.7+ æˆ– PostgreSQL 12+ æ•°æ®åº“
- æ•°æ®åº“å‡­æ®(ä¸»æœºã€ç«¯å£ã€ç”¨æˆ·åã€å¯†ç ã€æ•°æ®åº“å)
- æ•°æ®åº“æœåŠ¡å™¨çš„ç½‘ç»œè®¿é—®æƒé™

### æ­¥éª¤ 1: åˆ›å»ºé¡¹ç›®

```bash
npm create object-app my-enterprise-app
```

é€‰æ‹©é€‚å½“çš„æ¨¡æ¿:

```
? é€‰æ‹©ä¸€ä¸ªæ¨¡æ¿:
  SQLite æœ¬åœ°æ¨¡æ¿
â¯ MySQL ä¼ä¸šæ¨¡æ¿
  PostgreSQL ä¼ä¸šæ¨¡æ¿
  è‡ªå®šä¹‰é…ç½®
```

### æ­¥éª¤ 2: é…ç½®æ•°æ®åº“è¿æ¥

ç¼–è¾‘ `objectos.config.js`:

#### MySQL é…ç½®

```javascript
export default {
  datasources: {
    default: {
      driver: "mysql",
      host: "mysql.yourcompany.com",
      port: 3306,
      database: "objectstack_db",
      username: "objectstack_user",
      password: process.env.DB_PASSWORD,
      options: {
        charset: "utf8mb4",
        timezone: "+00:00",
        pool: {
          min: 2,
          max: 10
        }
      }
    }
  },
  server: {
    port: 3000,
    host: "0.0.0.0"
  },
  security: {
    secret: process.env.APP_SECRET,
    sessionTimeout: 7200 // 2 å°æ—¶
  }
};
```

#### PostgreSQL é…ç½®

```javascript
export default {
  datasources: {
    default: {
      driver: "postgresql",
      host: "postgres.yourcompany.com",
      port: 5432,
      database: "objectstack_db",
      username: "objectstack_user",
      password: process.env.DB_PASSWORD,
      options: {
        ssl: {
          rejectUnauthorized: false
        },
        pool: {
          min: 2,
          max: 10
        }
      }
    }
  }
};
```

### æ­¥éª¤ 3: ç¯å¢ƒå˜é‡

åˆ›å»º `.env` æ–‡ä»¶å­˜å‚¨æ•æ„Ÿå‡­æ®:

```bash
# æ•°æ®åº“
DB_PASSWORD=your_secure_password

# åº”ç”¨
APP_SECRET=your_random_secret_key_min_32_chars
NODE_ENV=production

# å¯é€‰: å¤šæ•°æ®åº“
DB_ANALYTICS_HOST=analytics.yourcompany.com
DB_ANALYTICS_PASSWORD=analytics_password
```

**å®‰å…¨æœ€ä½³å®è·µ**: æ°¸è¿œä¸è¦å°† `.env` æäº¤åˆ°ç‰ˆæœ¬æ§åˆ¶!

æ·»åŠ åˆ° `.gitignore`:

```
.env
.env.local
.env.*.local
```

### æ­¥éª¤ 4: æ•°æ®åº“åˆå§‹åŒ–

è¿è¡Œè¿ç§»ä»¥åˆ›å»º ObjectStack ç³»ç»Ÿè¡¨:

```bash
npm run migrate
```

è¿™å°†åˆ›å»º:

- ç”¨æˆ·è®¤è¯è¡¨
- æƒé™å’Œè§’è‰²è¡¨
- å¯¹è±¡å…ƒæ•°æ®è¡¨
- å®¡è®¡æ—¥å¿—è¡¨

### æ­¥éª¤ 5: è¿æ¥åˆ°é—ç•™è¡¨(å¯é€‰)

å¦‚æœæœ‰ç°æœ‰è¡¨,å°†å®ƒä»¬æ˜ å°„ä¸ºå¤–éƒ¨å¯¹è±¡:

```javascript
// src/objects/legacy_customer.object.js
export default {
  name: "legacy_customer",
  label: "å®¢æˆ·(é—ç•™)",
  table_name: "customers", // ç°æœ‰è¡¨å
  external: true,
  fields: {
    customer_id: {
      type: "number",
      label: "å®¢æˆ· ID",
      name: "id", // æ˜ å°„åˆ°ç°æœ‰åˆ—
      primary: true
    },
    customer_name: {
      type: "text",
      label: "åç§°",
      name: "name" // æ˜ å°„åˆ°ç°æœ‰åˆ—
    },
    email: {
      type: "email",
      label: "é‚®ç®±",
      name: "email_address"
    },
    // è™šæ‹Ÿå­—æ®µ - è®¡ç®—å¾—å‡º,ä¸åœ¨æ•°æ®åº“ä¸­
    full_info: {
      type: "formula",
      label: "å®Œæ•´ä¿¡æ¯",
      formula: "customer_name + ' (' + email + ')'"
    }
  }
};
```

### æ­¥éª¤ 6: å¯åŠ¨æœåŠ¡å™¨

```bash
npm run start
```

è®¿é—® `http://localhost:3000`

## é€‰é¡¹ 2: Docker å®¹å™¨éƒ¨ç½²

### å‰ç½®è¦æ±‚

- Docker 20.10+ å·²å®‰è£…
- Docker Compose(å¯é€‰,ç”¨äºå¤šå®¹å™¨è®¾ç½®)
- åŸºæœ¬çš„ Docker çŸ¥è¯†

### æ­¥éª¤ 1: æ‹‰å– ObjectOS é•œåƒ

```bash
docker pull objectstack/objectos:latest
```

### æ­¥éª¤ 2: åˆ›å»º Docker Compose æ–‡ä»¶

åˆ›å»º `docker-compose.yml`:

```yaml
version: '3.8'

services:
  objectos:
    image: objectstack/objectos:latest
    container_name: objectos-app
    ports:
      - "3000:3000"
    environment:
      - NODE_ENV=production
      - DB_HOST=postgres
      - DB_PORT=5432
      - DB_NAME=objectstack
      - DB_USER=objectstack
      - DB_PASSWORD=secure_password
      - APP_SECRET=your_secret_key_min_32_characters
    volumes:
      - ./src:/app/src
      - ./objectos.config.js:/app/objectos.config.js
      - objectos-storage:/app/storage
    depends_on:
      - postgres
    restart: unless-stopped

  postgres:
    image: postgres:15-alpine
    container_name: objectos-postgres
    environment:
      - POSTGRES_DB=objectstack
      - POSTGRES_USER=objectstack
      - POSTGRES_PASSWORD=secure_password
    volumes:
      - postgres-data:/var/lib/postgresql/data
    ports:
      - "5432:5432"
    restart: unless-stopped

  # å¯é€‰: Redis ç”¨äºä¼šè¯å­˜å‚¨
  redis:
    image: redis:7-alpine
    container_name: objectos-redis
    ports:
      - "6379:6379"
    volumes:
      - redis-data:/data
    restart: unless-stopped

volumes:
  postgres-data:
  redis-data:
  objectos-storage:
```

### æ­¥éª¤ 3: åˆ›å»ºåº”ç”¨ç›®å½•ç»“æ„

```bash
mkdir -p src/objects src/pages src/triggers
```

åˆ›å»ºç¤ºä¾‹å¯¹è±¡ `src/objects/contact.object.js`:

```javascript
export default {
  name: "contact",
  label: "è”ç³»äºº",
  fields: {
    name: { type: "text", label: "å§“å", required: true },
    email: { type: "email", label: "é‚®ç®±" },
    phone: { type: "phone", label: "ç”µè¯" },
    company: { type: "text", label: "å…¬å¸" }
  }
};
```

### æ­¥éª¤ 4: å¯åŠ¨å®¹å™¨

```bash
docker-compose up -d
```

æ£€æŸ¥çŠ¶æ€:

```bash
docker-compose ps
```

é¢„æœŸè¾“å‡º:

```
NAME                IMAGE                        STATUS
objectos-app        objectstack/objectos:latest  Up 2 minutes
objectos-postgres   postgres:15-alpine           Up 2 minutes
objectos-redis      redis:7-alpine               Up 2 minutes
```

### æ­¥éª¤ 5: æŸ¥çœ‹æ—¥å¿—

```bash
# æ‰€æœ‰æœåŠ¡
docker-compose logs -f

# ä»… ObjectOS
docker-compose logs -f objectos

# æœ€å 100 è¡Œ
docker-compose logs --tail=100 objectos
```

### æ­¥éª¤ 6: è®¿é—®åº”ç”¨

æ‰“å¼€æµè§ˆå™¨: `http://localhost:3000`

é»˜è®¤å‡­æ®(é¦–æ¬¡è¿è¡Œ):

- ç”¨æˆ·å: `admin`
- å¯†ç : `admin` (ç«‹å³æ›´æ”¹!)

## å¤šæ•°æ®åº“é…ç½®

åŒæ—¶è¿æ¥åˆ°å¤šä¸ªæ•°æ®åº“:

```javascript
// objectos.config.js
export default {
  datasources: {
    // ä¸»æ•°æ®åº“
    default: {
      driver: "postgresql",
      host: "postgres.internal",
      database: "main_db",
      username: "app_user",
      password: process.env.DB_PASSWORD
    },
    
    // é—ç•™ MySQL æ•°æ®åº“
    legacy: {
      driver: "mysql",
      host: "mysql.legacy.internal",
      database: "old_crm",
      username: "readonly_user",
      password: process.env.LEGACY_DB_PASSWORD
    },
    
    // åˆ†ææ•°æ®åº“
    analytics: {
      driver: "postgresql",
      host: "analytics.internal",
      database: "warehouse",
      username: "analytics_user",
      password: process.env.ANALYTICS_PASSWORD,
      options: {
        readOnly: true
      }
    }
  }
};
```

åœ¨å¯¹è±¡å®šä¹‰ä¸­ä½¿ç”¨ç‰¹å®šæ•°æ®æº:

```javascript
export default {
  name: "legacy_order",
  label: "é—ç•™è®¢å•",
  datasource: "legacy", // ä½¿ç”¨é—ç•™æ•°æ®æº
  table_name: "orders",
  external: true,
  fields: {
    // ... å­—æ®µå®šä¹‰
  }
};
```

## å¤šç§Ÿæˆ·é…ç½®

é…ç½®å¤šç»„ç»‡æ”¯æŒ:

```javascript
// objectos.config.js
export default {
  multiTenant: {
    enabled: true,
    mode: "schema", // æˆ– "database" æˆ– "discriminator"
    
    // åŸºäºæ¨¡å¼(PostgreSQL)
    schemaPattern: "tenant_{tenantId}",
    
    // åŸºäºæ•°æ®åº“(MySQL)
    // databasePattern: "tenant_{tenantId}_db",
    
    // åŸºäºåŒºåˆ†å­—æ®µ(å…±äº«è¡¨)
    // discriminatorField: "tenant_id"
  },
  
  tenantResolver: async (request) => {
    // ä»å­åŸŸåæå–ç§Ÿæˆ·
    const hostname = request.headers.host;
    const subdomain = hostname.split('.')[0];
    
    // æˆ–ä»è¯·æ±‚å¤´
    // const tenantId = request.headers['x-tenant-id'];
    
    return {
      id: subdomain,
      name: subdomain
    };
  }
};
```

## ç”Ÿäº§éƒ¨ç½²æ£€æŸ¥æ¸…å•

### å®‰å…¨

- [ ] æ›´æ”¹é»˜è®¤ç®¡ç†å‘˜å¯†ç 
- [ ] ä½¿ç”¨å¼º `APP_SECRET`(è‡³å°‘ 32 ä¸ªéšæœºå­—ç¬¦)
- [ ] å°†å¯†ç å­˜å‚¨åœ¨ç¯å¢ƒå˜é‡æˆ–å¯†é’¥ç®¡ç†å™¨ä¸­
- [ ] ä¸ºæ•°æ®åº“è¿æ¥å¯ç”¨ SSL/TLS
- [ ] é…ç½®é˜²ç«å¢™è§„åˆ™
- [ ] å¯ç”¨å®¡è®¡æ—¥å¿—

### æ€§èƒ½

- [ ] è®¾ç½®é€‚å½“çš„æ•°æ®åº“è¿æ¥æ± å¤§å°
- [ ] é…ç½® Redis ç”¨äºä¼šè¯å­˜å‚¨
- [ ] ä¸ºé™æ€èµ„æºå¯ç”¨ç¼“å­˜
- [ ] ä¸ºæ–‡ä»¶å­˜å‚¨è®¾ç½® CDN
- [ ] é…ç½®è´Ÿè½½å‡è¡¡å™¨(å¦‚ä½¿ç”¨å¤šå®ä¾‹)

### ç›‘æ§

- [ ] è®¾ç½®å¥åº·æ£€æŸ¥ç«¯ç‚¹
- [ ] é…ç½®åº”ç”¨æ—¥å¿—
- [ ] ç›‘æ§æ•°æ®åº“æ€§èƒ½
- [ ] ä¸ºé”™è¯¯è®¾ç½®å‘Šè­¦
- [ ] è·Ÿè¸ªèµ„æºä½¿ç”¨(CPUã€å†…å­˜ã€ç£ç›˜)

### å¤‡ä»½

- [ ] è‡ªåŠ¨åŒ–æ•°æ®åº“å¤‡ä»½
- [ ] æ–‡ä»¶å­˜å‚¨å¤‡ä»½
- [ ] æµ‹è¯•æ¢å¤æµç¨‹
- [ ] è®°å½•æ¢å¤è¿‡ç¨‹

## é«˜çº§: Kubernetes éƒ¨ç½²

Kubernetes æ¸…å•ç¤ºä¾‹:

### Deployment

```yaml
# objectos-deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: objectos
spec:
  replicas: 3
  selector:
    matchLabels:
      app: objectos
  template:
    metadata:
      labels:
        app: objectos
    spec:
      containers:
      - name: objectos
        image: objectstack/objectos:latest
        ports:
        - containerPort: 3000
        env:
        - name: DB_HOST
          valueFrom:
            configMapKeyRef:
              name: objectos-config
              key: db-host
        - name: DB_PASSWORD
          valueFrom:
            secretKeyRef:
              name: objectos-secrets
              key: db-password
        resources:
          requests:
            memory: "512Mi"
            cpu: "250m"
          limits:
            memory: "1Gi"
            cpu: "500m"
        livenessProbe:
          httpGet:
            path: /health
            port: 3000
          initialDelaySeconds: 30
          periodSeconds: 10
```

### Service

```yaml
# objectos-service.yaml
apiVersion: v1
kind: Service
metadata:
  name: objectos
spec:
  selector:
    app: objectos
  ports:
  - port: 80
    targetPort: 3000
  type: LoadBalancer
```

## æ•°æ®åº“è¿ç§»ç­–ç•¥

### é›¶åœæœºè¿ç§»

1. **åŒå†™é˜¶æ®µ**: åŒæ—¶å†™å…¥æ—§æ•°æ®åº“å’Œæ–°æ•°æ®åº“
2. **å›å¡«é˜¶æ®µ**: å¤åˆ¶å†å²æ•°æ®
3. **éªŒè¯é˜¶æ®µ**: éªŒè¯æ•°æ®ä¸€è‡´æ€§
4. **åˆ‡æ¢é˜¶æ®µ**: å°†è¯»å–è·¯ç”±åˆ°æ–°æ•°æ®åº“
5. **æ¸…ç†é˜¶æ®µ**: åˆ é™¤æ—§æ•°æ®åº“

### æ¸è¿›å¼è¿ç§»

```javascript
// ä½¿ç”¨å¯¹è±¡çº§æ•°æ®æºè·¯ç”±
export default {
  name: "customer",
  datasource: process.env.MIGRATION_PHASE === 'complete' 
    ? 'new_db' 
    : 'legacy_db',
  // ... å­—æ®µ
};
```

## æ•…éšœæ’é™¤

### è¿æ¥è¢«æ‹’ç»

```bash
# æ£€æŸ¥æ•°æ®åº“æ˜¯å¦è¿è¡Œ
docker-compose ps postgres

# æµ‹è¯•è¿æ¥
docker-compose exec postgres psql -U objectstack -d objectstack

# æŸ¥çœ‹æ—¥å¿—
docker-compose logs postgres
```

### æƒé™è¢«æ‹’ç»

```sql
-- æˆäºˆå¿…è¦æƒé™
GRANT ALL PRIVILEGES ON DATABASE objectstack TO objectstack_user;
GRANT ALL PRIVILEGES ON ALL TABLES IN SCHEMA public TO objectstack_user;
```

### å®¹å™¨æ— æ³•å¯åŠ¨

```bash
# æŸ¥çœ‹æ—¥å¿—
docker-compose logs objectos

# éªŒè¯é…ç½®
docker-compose config

# é‡å¯å®¹å™¨
docker-compose restart
```

## ä¸‹ä¸€æ­¥

> **æ³¨æ„**: ä»¥ä¸‹é“¾æ¥æŒ‡å‘æ­£åœ¨å¼€å‘ä¸­çš„æœªæ¥æ–‡æ¡£ç« èŠ‚ã€‚

- å¤šç§Ÿæˆ·é…ç½®(å³å°†æ¨å‡º)
- å®‰å…¨ä¸æƒé™(å³å°†æ¨å‡º)
- ç›‘æ§ä¸æ—¥å¿—(å³å°†æ¨å‡º)
- é«˜å¯ç”¨æ€§è®¾ç½®(å³å°†æ¨å‡º)

## è·å–å¸®åŠ©

> **æ³¨æ„**: å•†ä¸šæ–‡æ¡£æ­£åœ¨å¼€å‘ä¸­ã€‚

- ğŸ“š ä¼ä¸šæ–‡æ¡£(å³å°†æ¨å‡º)
- ğŸ’¼ [ä¼ä¸šæ”¯æŒ](https://objectstack.io/enterprise)
- ğŸ”§ [ä¸“ä¸šæœåŠ¡](https://objectstack.io/services)
